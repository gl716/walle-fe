{"version":3,"sources":["webpack:///src/views/task/src/task/log.vue","webpack:///./src/views/task/src/task/log.vue?73f7","webpack:///./src/views/task/src/task/log.vue","webpack:///src/views/task/src/task/deploy.task.vue","webpack:///./src/views/task/src/task/deploy.task.vue?b27b","webpack:///./src/views/task/src/task/deploy.task.vue"],"names":["log","name","props","value","Array","methods","getLogClass","item","status","getLogContext","success","error","getLogCommand","Object","utils","cmd","output","task_log","render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_l","i","key","_s","class","_e","staticRenderFns","STAGE","prev_release","release","post_release","prev_deploy","deploy","post_deploy","deploy_task","components","DeployLog","__webpack_require__","normalizeComponent","ssrContext","taskId","String","Number","data","breadcrumbData","to","activeStep","record","loading","reConnectCount","created","initWebSocket","destroyed","websock","close","WebSocket","onmessage","websocketonmessage","onopen","websocketonopen","onerror","websocketonerror","actions","text","websocketsend","stringify_default","$loading","lock","spinner","background","e","redata","JSON","parse","push","console","stage","Data","send","task_deploy_task","attrs","active","finish-status","title","deploy_task_Component","deploy_task_normalizeComponent","__webpack_exports__"],"mappings":"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","file":"static/js/7.8474c8dd086a95b0902e.js","sourcesContent":["<template>\n    <div class=\"wl-task-log\">\n        <div class=\"wl-task-log__body\">\n            <pre>\n                <template v-for=\"(item,i) in value\">\n                    <div class=\"wl-task-log__line\" :key=\"i+'command'\">\n                        <a></a>\n                        <span class=\"command\">{{getLogCommand(item)}}</span>\n                    </div>\n                    <div class=\"wl-task-log__line\" :key=\"i+'log'\" v-if=\"getLogContext(item)\">\n                        <a></a>\n                        <span :class=\"getLogClass(item)\">{{getLogContext(item)}}</span>\n                    </div>\n                </template>\n            </pre>\n        </div>\n    </div>\n</template>\n\n<script>\nimport {isObject} from '@/utils'\nexport default {\n  name: 'deploy-log',\n  props: {\n    value: Array\n  },\n  methods: {\n    getLogClass (item) {\n      if (item.status === 0) return 'success'\n      else return 'error'\n    },\n    getLogContext (item) {\n      if (item.status === 0) return item.success\n      else return item.error\n    },\n    getLogCommand (item) {\n      if (isObject(item)) {\n        return item.cmd || item.output || ''\n      } else {\n        return item\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n@import 'scss';\n\n@include b(task-log) {\n    flex-grow: 1;\n    overflow: auto;\n\n   @include e(body) {\n      position: relative;\n\n      pre {\n        clear: left;\n        min-height: 42px;\n        padding: 15px 0;\n        color: #f1f1f1;\n        font-family: Cousine,monospace;\n        font-size: 12px;\n        line-height: 19px;\n        white-space: normal;\n        word-wrap: break-word;\n        background-color: #222;\n        counter-reset: line-numbering;\n        margin-top: 0;\n        margin-bottom: -45px;\n      }\n   }\n\n   @include e(line) {\n        position: relative;\n        margin: 0 50px;\n        min-height: 19px;\n        white-space: normal;\n        border-left: 1px solid #666;\n        padding: 0 10px;\n\n        a {\n          display: inline-block;\n          text-align: right;\n          min-width: 50px;\n          cursor: pointer;\n          text-decoration: none;\n          position: absolute;\n          color: #666;\n          top: 0;\n          left: -50px;\n\n          &::before {\n            content: counter(line-numbering);\n            counter-increment: line-numbering;\n            padding-right: 1em;\n          }\n        }\n\n        span {\n          color: #bbb;\n        }\n\n        .error {\n          color: #f00;\n        }\n\n        .success {\n          color: #B1FD79;\n        }\n      }\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/views/task/src/task/log.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wl-task-log\"},[_c('div',{staticClass:\"wl-task-log__body\"},[_c('pre',[_vm._v(\"            \"),_vm._l((_vm.value),function(item,i){return [_vm._v(\"\\n                \"),_c('div',{key:i+'command',staticClass:\"wl-task-log__line\"},[_vm._v(\"\\n                    \"),_c('a'),_vm._v(\"\\n                    \"),_c('span',{staticClass:\"command\"},[_vm._v(_vm._s(_vm.getLogCommand(item)))]),_vm._v(\"\\n                \")]),_vm._v(\"\\n                \"),(_vm.getLogContext(item))?_c('div',{key:i+'log',staticClass:\"wl-task-log__line\"},[_vm._v(\"\\n                    \"),_c('a'),_vm._v(\"\\n                    \"),_c('span',{class:_vm.getLogClass(item)},[_vm._v(_vm._s(_vm.getLogContext(item)))]),_vm._v(\"\\n                \")]):_vm._e(),_vm._v(\"\\n            \")]}),_vm._v(\"\\n        \")],2)])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2682d50c\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/task/src/task/log.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-2682d50c\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./log.vue\")\n}\nvar normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./log.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./log.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-2682d50c\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./log.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/task/src/task/log.vue\n// module id = null\n// module chunks = ","<template>\n    <div class=\"wl-task-deploy\">\n        <wl-breadcrumb :data=\"breadcrumbData\"></wl-breadcrumb>\n        <el-steps :active=\"activeStep\" finish-status=\"finish\">\n            <el-step title=\"prev_release\"></el-step>\n            <el-step title=\"release\"></el-step>\n            <el-step title=\"post_release\"></el-step>\n            <el-step title=\"prev_deploy\"></el-step>\n            <el-step title=\"deploy\"></el-step>\n            <el-step title=\"post_deploy\"></el-step>\n        </el-steps>\n        <deploy-log :value=\"record\"></deploy-log>\n    </div>\n</template>\n<script>\nimport DeployLog from './log.vue'\nconst STAGE = {\n  prev_release: 1,\n  release: 2,\n  post_release: 3,\n  prev_deploy: 4,\n  deploy: 5,\n  post_deploy: 6\n}\nexport default {\n  components: {DeployLog},\n  props: {\n    taskId: [String, Number]\n  },\n  data () {\n    return {\n      breadcrumbData: [\n        {\n          to: '/deploy/index',\n          name: '上线单'\n        },\n        {\n          to: '',\n          name: '发布'\n        }\n      ],\n      activeStep: 0,\n      record: [],\n      loading: null,\n      reConnectCount: 5\n    }\n  },\n  created () {\n    this.initWebSocket()\n  },\n  destroyed () {\n    this.websock.close() // 离开路由之后断开websocket连接\n  },\n  methods: {\n    initWebSocket () { // 初始化weosocket\n      const wsuri = `ws://api.walle-web.io/websocket/console`\n      this.websock = new WebSocket(wsuri)\n      this.websock.onmessage = this.websocketonmessage\n      this.websock.onopen = this.websocketonopen\n      this.websock.onerror = this.websocketonerror\n      this.reConnectCount--\n      // this.websock.onclose = this.websocketclose\n    },\n    websocketonopen () { // 连接建立之后执行send方法发送数据\n      this.loading && this.loading.close()\n      let actions = {'text': this.taskId}\n      this.websocketsend(JSON.stringify(actions))\n    },\n    websocketonerror () { // 连接建立失败重连\n      if (!this.loading) {\n        this.loading = this.$loading({\n          lock: true,\n          text: 'Loading',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)'\n        })\n      }\n      if (this.reConnectCount > 0) {\n        this.initWebSocket()\n      }\n    },\n    websocketonmessage (e) { // 数据接收\n      const redata = JSON.parse(e.data)\n      this.record.push(redata)\n      // this.activeStep++\n      console.log(redata)\n      if (redata && redata.stage) {\n        this.activeStep = STAGE[redata.stage]\n      }\n    },\n    websocketsend (Data) { // 数据发送\n      this.websock.send(Data)\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n@import 'scss';\n\n@include b(task-deploy) {\n   margin: 20px;\n   box-sizing: border-box;\n   background: #fff;\n   height: calc(100% - 40px);\n   padding: 10px;\n   display: flex;\n   flex-direction: column;\n\n   .el-steps {\n     min-height: 80px;\n   }\n\n   .wl-breadcrumb {\n     min-height: 35px;\n   }\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/views/task/src/task/deploy.task.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wl-task-deploy\"},[_c('wl-breadcrumb',{attrs:{\"data\":_vm.breadcrumbData}}),_vm._v(\" \"),_c('el-steps',{attrs:{\"active\":_vm.activeStep,\"finish-status\":\"finish\"}},[_c('el-step',{attrs:{\"title\":\"prev_release\"}}),_vm._v(\" \"),_c('el-step',{attrs:{\"title\":\"release\"}}),_vm._v(\" \"),_c('el-step',{attrs:{\"title\":\"post_release\"}}),_vm._v(\" \"),_c('el-step',{attrs:{\"title\":\"prev_deploy\"}}),_vm._v(\" \"),_c('el-step',{attrs:{\"title\":\"deploy\"}}),_vm._v(\" \"),_c('el-step',{attrs:{\"title\":\"post_deploy\"}})],1),_vm._v(\" \"),_c('deploy-log',{attrs:{\"value\":_vm.record}})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-4419483c\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/task/src/task/deploy.task.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4419483c\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./deploy.task.vue\")\n}\nvar normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./deploy.task.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./deploy.task.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4419483c\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./deploy.task.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/task/src/task/deploy.task.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}