webpackJsonp([8],{"7hsY":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("mvHQ"),a=s.n(n),o=s("Xxa5"),r=s.n(o),i=s("exGp"),l=s.n(i),c=s("0xDb"),d={name:"deploy-log",props:{value:Array},methods:{getLogClass:function(t){return 0===t.status?"success":"error"},getLogContext:function(t){return 0===t.status?t.success:t.error},getLogCommand:function(t){return Object(c.b)(t)?t.cmd||t.output||"":t}}},u={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wl-task-log"},[s("div",{staticClass:"wl-task-log__body"},[s("pre",[t._v("            "),t._l(t.value,function(e,n){return[t._v("\n                "),s("div",{key:n+"command",staticClass:"wl-task-log__line"},[t._v("\n                    "),s("a"),t._v("\n                    "),s("span",{staticClass:"command"},[t._v("$ "+t._s(t.getLogCommand(e)))]),t._v("\n                ")]),t._v("\n                "),t.getLogContext(e)?s("div",{key:n+"log",staticClass:"wl-task-log__line"},[t._v("\n                    "),s("a"),t._v("\n                    "),s("span",{class:t.getLogClass(e)},[t._v(t._s(t.getLogContext(e)))]),t._v("\n                ")]):t._e(),t._v("\n            ")]}),t._v("\n        ")],2)])])},staticRenderFns:[]};var p=s("VU/8")(d,u,!1,function(t){s("8PZR")},null,null).exports,_=s("4kd1"),v={prev_deploy:1,deploy:2,post_deploy:3,prev_release:4,release:5,post_release:6},k={components:{DeployLog:p},props:{taskId:[String,Number]},data:function(){return{breadcrumbData:[{to:"/deploy/index",name:"上线单"},{to:"",name:"发布"}],activeStep:0,record:[],loading:null,reConnectCount:5,task:null,isStart:!1}},created:function(){this.getTask()},destroyed:function(){this.websock.close()},methods:{getTask:function(){var t=this;return l()(r.a.mark(function e(){var s,n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.d)(t.taskId);case 2:s=e.sent,n=s.data,t.task=n;case 5:case"end":return e.stop()}},e,t)}))()},start:function(){this.isStart=!0,this.initWebSocket()},initWebSocket:function(){var t="ws://"+location.host+"/websocket/console";this.websock=new WebSocket(t),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.reConnectCount--},websocketonopen:function(){this.loading&&this.loading.close();var t={text:this.taskId};this.websocketsend(a()(t))},websocketonerror:function(){this.loading||(this.loading=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})),this.reConnectCount>0&&this.initWebSocket()},websocketonmessage:function(t){var e=JSON.parse(t.data);this.record.push(e),e&&e.stage&&(this.activeStep=v[e.stage])},websocketsend:function(t){this.websock.send(t)}}},g={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wl-task-deploy"},[s("wl-breadcrumb",{attrs:{data:t.breadcrumbData}}),t._v(" "),t.task?s("div",{staticClass:"wl-task-deploy__header"},[s("span",{staticClass:"title"},[t._v(t._s(t.task.project_name))]),s("span",{staticClass:"title"},[t._v("/")]),s("span",{staticClass:"title"},[t._v(t._s(t.task.name))]),t._v(" "),s("el-button",{attrs:{type:"success",size:"small",disabled:t.isStart},on:{click:t.start}},[t._v("开始")])],1):t._e(),t._v(" "),t.isStart?s("el-steps",{attrs:{active:t.activeStep,"finish-status":"finish"}},[s("el-step",{attrs:{title:"prev_deploy"}}),t._v(" "),s("el-step",{attrs:{title:"deploy"}}),t._v(" "),s("el-step",{attrs:{title:"post_deploy"}}),t._v(" "),s("el-step",{attrs:{title:"prev_release"}}),t._v(" "),s("el-step",{attrs:{title:"release"}}),t._v(" "),s("el-step",{attrs:{title:"post_release"}})],1):t._e(),t._v(" "),t.isStart?s("deploy-log",{attrs:{value:t.record}}):t._e()],1)},staticRenderFns:[]};var b=s("VU/8")(k,g,!1,function(t){s("P6aG")},null,null);e.default=b.exports},"8PZR":function(t,e){},P6aG:function(t,e){}});